<!doctype html>
<html>

<head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width,initial-scale=1' />
    <title>Artikel Admin</title>
    <link rel='stylesheet' href='/assets/css/style.css' />
</head>

<body>
    <main class='container'>
        <section class='card'>
            <h2>Manajemen Artikel</h2>
            <form id='fa'>
                <div class='form-row'><input id='judul' placeholder='Judul' /></div>
                <div class='form-row'><textarea id='konten' placeholder='Konten'></textarea></div>
                <div><button type='submit'>Tambah</button></div>
            </form>
            <div id='alist'></div>
        </section>
    </main>
    <script src='/assets/js/api.js'></script>
    <script>
        var token = localStorage.getItem('token');
        if (!token) location.href = '/admin/login.html';
        document.getElementById('fa').addEventListener('submit', async function (e) {
            e.preventDefault();
            await api.post('/artikel', {
                judul: document.getElementById('judul').value,
                konten: document.getElementById('konten').value
            }, {
                auth: token
            });
            load()
        });
        async function load() {
            var a = await api.get('/artikel');
            var out = '';
            for (var i = 0; i < a.length; i++) {
                out += '<div>' + a[i].judul + ' <button onclick="del(\'' + a[i]._id + '\')">Hapus</button></div>';
            }
            document.getElementById('alist').innerHTML = out;
        }
        async function del(id) {
            await api.del('/artikel/' + id, {
                auth: token
            });
            load()
        }
        load();
    </script>
</body>

</html>